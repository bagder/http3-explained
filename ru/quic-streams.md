# Потоки
Потоки в QUIC обеспечивают легкую, упорядоченную абстракцию потока байтов.

В QUIC существует два основных типа потоков:
 - Однонаправленные — передают данные от инициатора потока к его узлу.
 - Двунаправленные — позволяет отправлять данные в оба направления.

Любой тип потока может быть создан любой конечной точкой, может
одновременно отправлять данные, чередующиеся с другими потоками,
и может быть отменен.

Для передачи данных по соединению QUIC используется один или несколько потоков.


## Порядок доставки
Потоки управляются индивидуально, что позволяет конечной точке ограничивать
объем памяти и оказывать обратное давление. Создание потоков также управляется
потоком, при этом каждый узел объявляет максимальный идентификатор потока, который
он готов принять в данный момент времени.

## Идентификаторы потоков
Потоки идентифицируются 62-разрядным целым числом без знака. Два младших по значению
бита используются для идентификации типа потока (Однонаправленный или двунаправленный)
и инициатора потока.

Младший значащий бит (0x1) идентифицирует инициатора потока. Клиенты инициируют потоки
с четными номерами (То есть, у которых младший значащий бит установлен в 0). Серверы
инициируют потоки с нечетными номерами (То есть, у которых младший значащий бит установлен в 1).

Второй младший по значению бит (0x2) проводит различие между однонаправленными
и двунаправленными потоками. Для однонаправленных потоков этот бит всегда равен 1,
а для двунаправленных потоков этот бит установлен в 0.


## Параллелизм потоков
QUIC позволяет произвольному количеству потоков работать одновременно. Конечная
точка ограничивает количество одновременно активных входящих потоков, ограничивая
максимальный идентификатор потока.

Максимальный идентификатор специфичен для каждой конечной точки и применяется только
к узлу, который получает настройку.


## Отправка и получение данных
Конечные точки используют потоки для отправки и получения данных. В конце концов,
это их конечная цель. Потоки — это упорядоченная абстракция потока байтов. Однако
отдельные потоки необязательно доставляются в первоначальном порядке.


## Приоритизация потоков
Мультиплексирование потоков оказывает значительное влияние на производительность
приложения, если ресурсы, выделяемые потокам, правильно распределены по приоритетам.
Опыт работы с другими мультиплексированными протоколами, такими как HTTP/2, показывает,
что эффективные стратегии определения приоритетов оказывают значительное положительное
влияние на производительность.

Сам по себе QUIC не предоставляет кадров для обмена информацией о приоритизации.
Вместо этого он полагается на получение информации о приоритете от приложения,
использующего QUIC. Протоколы, использующие QUIC, способны определять любую
схему расстановки приоритетов, соответствующую семантике их приложения.

Была высказана критика и опасения модели определения приоритетов HTTP/2 о том,
что она чрезмерно сложна и не используется и не внедрена многими серверами HTTP/2.
На данный момент определение приоритетов в HTTP/3 было удалено из основной спецификации
HTTP/3 и разрабатывается как [отдельная спецификация](https://tools.ietf.org/html/draft-ietf-httpbis-priority).
