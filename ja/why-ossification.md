# 硬直化

インターネットは「ネットワーク同士のネットワーク」です。
このネットワーク同士のネットワークを、想定通り確実に動作させるため、インターネット上の実に様々な場所に機器が設置されています。
ネットワーク上に散りばめられたこれら機器のことを「ミドルボックス」と呼びます。
2つのエンドポイント間の、あちこちに存在しているこれらミドルボックスが、旧来からのネットワークデータ転送に関わっています。

ミドルボックスは、様々な目的で様々な動作をしていますが、それらは、インターネットを正しく動作させるために必要だと、誰かが考えた結果設置されたものだ、と広い意味で捉えることができると思います。

ミドルボックスは、ネットワーク間で IP パケットのルーティングを行います。
また、悪意のあるトラフィックをブロックします。
NAT(Network Address Translation)を行ったり、パフォーマンスを向上させたり、通過するトラフィックを監視したり、それ以外にも様々なことを行います。

これらの役割を担うため、ミドルボックスは「ネットワーク間がどうつながっているのか」や、監視・管理の対象である、プロトコルの詳細について知らなければなりません。
こういった目的で、ミドルボックスはソフトウェアを動かします。
必ずしも頻繁にアップデートされるわけではないソフトウェアを。

ミドルボックスは、インターネットを維持するための接着剤の役割を果たしていますが、最新技術に追従できていないこともよくあります。
ネットワーク中間段の典型的な機器は、世界中のクライアントやサーバーといった、ネットワーク境界の機器ほどには素早く変化しません。

全てのネットワークプロトコルには以下の問題が付いて回ります。
プロトコルを分析し、何を許可し、何をブロックするか判断したいと考え、機器を設置したとすると、その機器は設置した当時の仕様で動作します。
当時知られていなかった、新しい仕様の追加や、振る舞いの変化があると、その機器にとっては、不具合や不正といったリスクと見なされます。
このようなトラフィックは、単に捨てられたり、あるいはその機能を使用したくないと思うほど遅延させられたりします。

このような状況は「プロトコルの硬直化」と呼ばれます。

TCP も硬直化によって変化が難しい状況にあります。
クライアントとサーバーの間にある機器が、新しい TCP オプションを不明なものとしてブロックするかもしれません。
プロトコルの詳細が分析できると、それを取り巻くシステムはプロトコルの典型的な振る舞いを学習していき、やがてプロトコルの変更を不可能にしてしまいます。

この硬直化と「戦う」ための真に効果的な唯一の方法は、可能な限り通信を暗号化し、ミドルボックスに、そこを通過するプロトコルの詳細を観察させないようにすることです。
