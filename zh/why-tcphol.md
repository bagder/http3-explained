## TCP队头阻塞（head of line blocking）

HTTP/2是基于TCP实现的。相比之前的版本，HTTP/2的TCP连接数少了很多。TCP是一个可靠的传输协议，基本上，你可以认为它在两台机器之中建立了一条链条。从一头放到网络上的数据会最终按相同的顺序出现在另一头上（不然连接就断了）。

![两台电脑间的TCP管道](../images/tcp-chain.png)

使用HTTP/2时，浏览器一般会在单个TCP连接之中平行创建上百个传输流。

如果HTTP/2的连接双方发生了一个丢包情况，整个TCP连接就会暂停，丢包的报文需要重新传输。因为TCP是按序传输的，这意味着如果一个连接瞬间失联了，整个连接都需要等待。

我们用链条来比喻TCP连接，如下图含有红色和绿色两个数据流：

![不同颜色的链条代表不同的连接](../images/tcp-chain-streams.png)

这种单个报文造成的阻塞，就是TCP队头阻塞。

随着丢包率的上升，HTTP/2的表现越来越糟糕。在2%的丢包率（很差的网络）中，测试结果表示HTTP/1的用户性能更好，因为HTTP/1一般有6个连接，就算一个连接阻塞了，另外的连接还是好的。

在TCP下解决这个问题非常困难，近乎不可能。

## 独立数据流解决了阻塞问题

在QUIC中，我们的连接仍然是安全且可靠的。

![一条两台电脑间的QUIC链条](../images/tcp-chain.png)

但是，如果我们在这个连接上建立两个数据流，它们会互相独立。也就是说，如果一个数据流丢包了，只有那个数据流会停下来，等待重传。

下面是两个端点间黄色和蓝色独立数据流的示意图。

![两台电脑间的两个QUIC数据流](../images/quic-chain-streams.png)
